define("xg/eid-company-zy/1.0.4/c/js/base.form",["core"],function(require,exports,module){function checkFormVerification(form){for(var firstErrorElemtent,verificationSucc=!0,verification=$(form).find("*[data-format]:visible"),i=verification.length-1;i>=0;i--){var element=verification.eq(i);removeMsgHolder($(element));var patrn=new RegExp(element.attr("data-format")),value=element.val();patrn.exec(null===value||void 0===value?"":value)?$(element).removeClass("formaterr"):(firstErrorElemtent=element,element.attr("data-onerror")&&createMsgHolder("error",element.attr("data-onerror"),element),$(element).addClass("formaterr"),verificationSucc=!1)}verification=$(form).find("*[data-valueas]:visible");for(var i=verification.length-1;i>=0;i--){var element=verification.eq(i);removeMsgHolder($(element));var oriValue=$(element.attr("data-valueas")).val();""==element.val()?(firstErrorElemtent=element,element.attr("data-onerror")&&createMsgHolder("info",element.attr("data-onerror"),element),$(element).addClass("formaterr"),verificationSucc=!1):element.val()!=oriValue&&(firstErrorElemtent=element,element.attr("data-onerror")&&createMsgHolder("error",element.attr("data-onerror"),element),$(element).addClass("formaterr"),verificationSucc=!1)}return verificationSucc||setTimeout(function(){firstErrorElemtent.focus()},200),verificationSucc}function createMsgHolder(type,content,_for){if(content){var msgholder=$('<div class="msgholder '+type+'" data-index="'+ ++msgHolderIndex+'">'+content+"</div>");return msgHolderMapper[msgHolderIndex]=_for[0],removeMsgHolder(_for),_for.is("select")&&_for.next(".select2-container").length>0?_for=_for.next(".select2-container"):_for.parent(".input-group").length>0?_for=_for.parent(".input-group"):_for.parent(".form-control").length>0&&(_for=_for.parent(".form-control")),_for.after(msgholder),msgholder}}function removeMsgHolder(_for){$(".msgholder").each(function(){msgHolderMapper[$(this).data("index")]==_for[0]&&$(this).remove()})}var core=require("core");$("form").on("blur input propertychange change","*[data-format]",function(){var patrn=new RegExp($(this).attr("data-format"));patrn.exec($(this).val())?(removeMsgHolder($(this)),$(this).removeClass("formaterr")):(""==$(this).val()||createMsgHolder("error",$(this).attr("data-onerror"),$(this)),$(this).addClass("formaterr"))}),$("form").on("blur","*[data-format]",function(){var patrn=new RegExp($(this).attr("data-format"));patrn.exec($(this).val())?(removeMsgHolder($(this)),$(this).removeClass("formaterr")):(""==$(this).val()?removeMsgHolder($(this)):createMsgHolder("error",$(this).attr("data-onerror"),$(this)),$(this).addClass("formaterr"))}),$("form").on("blur input propertychange change","*[data-valueas]",function(){var oriValue=$($(this).attr("data-valueas")).val();""==$(this).val()?createMsgHolder("info",$(this).attr("data-onfocus"),$(this)):$(this).val()!=oriValue?createMsgHolder("error",$(this).attr("data-onerror"),$(this)):removeMsgHolder($(this))}),$("form").on("focus click","*[data-onfocus]",function(){createMsgHolder("info",$(this).attr("data-onfocus"),$(this))}),$("form").on("input propertychange","input[name=checkCode]",function(){this.value=this.value.toUpperCase()}),$("form").find("input[type=password][check-strength]").on("input propertychange focus",function(){if($(".strength-bar").remove(),""!=this.value){var checkresult=PasswordStrength.StrengthLevel(this.value);isNaN(checkresult.value)?$(this).parents(".controls:first").before('<label class="control-lable strength-bar"><div style="color:#ff6e00">密码中含有不允许的字符</div></label>'):checkresult.value<21?$(this).parents(".controls:first").before('<label class="control-lable strength-bar"><span style="background:#fcbf90"></span>'+checkresult.level+"</label>"):checkresult.value<30?$(this).parents(".controls:first").before('<label class="control-lable strength-bar"><span style="background:#fcbf90"></span><span style="background:#fe903d"></span>'+checkresult.level+"</label>"):$(this).parents(".controls:first").before('<label class="control-lable strength-bar"><span style="background:#fcbf90"></span><span style="background:#fe903d"></span><span style="background:#ff6e00"></span>'+checkresult.level+"</label>"),checkresult.value>$(this).attr("check-strength")?$(this).attr("data-format","^[a-zA-Z\\d\\(\\)\\-\\,\\.\\?\\:\\;\\'\\!]{1,20}$"):$(this).attr("data-format","^.{0}$")}});var PasswordStrength={Level:["高","中","低"],LevelValue:[30,21,0],Factor:[1,1,1,1],KindFactor:[0,15,15,15],Regex:[/[a-z]/g,/[A-Z]/g,/\d/g,/[\(\)\-\,\.\?\:\;\'\!]/g]};PasswordStrength.StrengthValue=function(pwd){if(0==pwd.length)return 0;for(var strengthValue=0,ComposedKind=0,i=0;i<this.Regex.length;i++){var chars=pwd.match(this.Regex[i]);null!=chars&&(strengthValue+=this.Factor[i]*(chars.length>20?20:chars.length),ComposedKind++)}return strengthValue+=this.KindFactor[ComposedKind-1]},PasswordStrength.StrengthLevel=function(pwd){for(var result={value:this.StrengthValue(pwd)},i=0;i<this.LevelValue.length;i++)if(result.value>=this.LevelValue[i]){result.level=this.Level[i];break}return result},$(document).on("submit","form[data-role=ajax]",function(){var that=this,verificationSucc=checkFormVerification(this);if(verificationSucc){var layerIndex=layer.load(0,{shade:.2});$(this).ajaxSubmit({type:"post",success:function(json){layer.close(layerIndex);var result;if(result=json instanceof Object?json:eval("("+json+")"),0==result.code){var dataReload=$(that).data("reload"),isLayerFrame=!!parent&&parent.layer.getFrameIndex(window.name),location="none"==dataReload?{reload:function(){}}:isLayerFrame&&"self"!=dataReload?parent.location:window.location;layer.msg("操作成功完成！"+(result.msg?result.msg:""),{icon:1,time:2500},function(){result.redirect?location.href=result.redirect:core.getQueryString("goto")?location.href=decodeURIComponent(modal.core.getQueryString("goto")):location.reload()})}else layer.msg(result.error?result.error:"请求失败！",{icon:2,time:3500})},error:function(err){if(layer.close(layerIndex),403!=err.status)$(document).html(err.responseText);else{var modal=$('<div class="modal" id="modal-add-event" data-backdrop="static">\r\n                <div class="modal-header">\r\n                  <h3>系统消息</h3>\r\n                </div>\r\n                <div class="modal-body">\r\n                  <p class="ft18">您的登陆已失效，请重新登陆。</p>\r\n                </div>\r\n                <div class="modal-footer"><a href="/login" class="btn btn-primary">确定</a> </div>\r\n           </div>');$("body").append(modal),modal.modal({keyboard:!1})}}})}return!1}),module.exports={checkFormVerification:checkFormVerification};var msgHolderMapper={},msgHolderIndex=0});